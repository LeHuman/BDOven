add_library(libraries STATIC)

MACRO(ADD_LIB path_prefix)
    FILE(GLOB_RECURSE new_list ${CMAKE_CURRENT_LIST_DIR}/${path_prefix}/*.h | ${CMAKE_CURRENT_LIST_DIR}/${path_prefix}/*.hpp)
    SET(dir_list "")
    FOREACH(file_path ${new_list})
        GET_FILENAME_COMPONENT(dir_path ${file_path} PATH)
        SET(dir_list ${dir_list} ${dir_path})
    ENDFOREACH()
    LIST(REMOVE_DUPLICATES dir_list)

    FILE(GLOB new_list ${CMAKE_CURRENT_LIST_DIR}/${path_prefix}/*.c | ${CMAKE_CURRENT_LIST_DIR}/${path_prefix}/*.cpp | ${CMAKE_CURRENT_LIST_DIR}/${path_prefix}/*.S)
    target_sources(libraries PUBLIC ${new_list})
    target_include_directories(libraries PUBLIC ${dir_list})
ENDMACRO()

make_directory(${CMAKE_CURRENT_LIST_DIR}/PID-MOD)
file(READ "PID-Library/PID (cpp version)/pid.h" PID_HEADER)
set(PID_HEADER "#include \"Arduino.h\"\n#define GetTime millis\n${PID_HEADER}")
file(WRITE ${CMAKE_CURRENT_LIST_DIR}/PID-MOD/pid.h "${PID_HEADER}")
configure_file("PID-Library/PID (cpp version)/pid.cpp" ${CMAKE_CURRENT_LIST_DIR}/PID-MOD/pid.cpp)

ADD_LIB(ILI9341_T4/src)
ADD_LIB(PID-MOD)
ADD_LIB(PXP)
ADD_LIB(SPI)
ADD_LIB(spline/src)
ADD_LIB(T4_PXP/src)
ADD_LIB(Time)
ADD_LIB(gif/src)

target_include_directories(libraries PUBLIC ${CMAKE_CURRENT_LIST_DIR})
target_link_libraries(libraries core)

add_subdirectory(lvgl)
target_link_libraries(lvgl libraries)